#![allow(
	unused_crate_dependencies,
	reason = "binary lives in xeno-registry package and relies on shared deps"
)]

use xeno_registry::{
	COMMANDS, GUTTERS, HOOKS, MOTIONS, NOTIFICATIONS, RegistryMetadata, STATUSLINE_SEGMENTS,
	TEXT_OBJECTS, all_actions,
};

fn print_registry<T: RegistryMetadata + 'static>(
	label: &str,
	items: impl IntoIterator<Item = &'static T>,
) {
	let mut ids: Vec<&'static str> = items.into_iter().map(|item| item.id()).collect();
	ids.sort_unstable();

	println!("## {} ({})", label, ids.len());
	for id in ids {
		println!("- {}", id);
	}
	println!();
}

fn print_notifications(
	label: &str,
	items: impl IntoIterator<Item = &'static xeno_registry::NotificationDef>,
) {
	let mut ids: Vec<&'static str> = items.into_iter().map(|item| item.id).collect();
	ids.sort_unstable();

	println!("## {} ({})", label, ids.len());
	for id in ids {
		println!("- {}", id);
	}
	println!();
}

fn main() {
	println!("# Registry Inventory");
	println!();
	println!("Generated by `cargo run -p xeno-registry --bin registry_inventory`.");
	println!();

	print_registry("Actions", all_actions());
	print_registry("Commands", COMMANDS.iter().copied());
	print_registry("Motions", MOTIONS.iter());
	print_registry("Gutters", GUTTERS.iter());
	print_registry("Hooks", HOOKS.iter().copied());
	print_registry("Statusline Segments", STATUSLINE_SEGMENTS.iter());
	print_registry("Text Objects", TEXT_OBJECTS.iter());
	print_registry("Options", xeno_registry::options::OPTIONS.iter());
	print_registry("Themes", xeno_registry::themes::THEMES.iter());
	print_notifications("Notifications", NOTIFICATIONS.iter().copied());
}
