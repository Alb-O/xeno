//! Action result type.
//!
//! The [`ActionResult`] enum is the return type for all action handlers,
//! describing what the editor should do after an action executes.

use linkme::distributed_slice;
use xeno_macro::DispatchResult;

use crate::editor_ctx::ResultHandler;
use crate::effects::ActionEffects;

/// Extension handlers for action results.
///
/// These run after the core per-variant handler slices generated by
/// `#[derive(DispatchResult)]`. Extension handlers should return
/// [`HandleOutcome::NotHandled`](crate::editor_ctx::HandleOutcome::NotHandled)
/// when they don't apply.
#[distributed_slice]
pub static RESULT_EXTENSION_HANDLERS: [ResultHandler];

/// Screen-relative cursor position.
#[derive(Debug, Clone, Copy, PartialEq, Eq)]
pub enum ScreenPosition {
	/// First visible line (vim H).
	Top,
	/// Middle visible line (vim M).
	Middle,
	/// Last visible line (vim L).
	Bottom,
}

/// Result of executing an action.
///
/// All actions return `ActionResult::Effects(...)` containing composable
/// primitive effects. The `apply_effects` function processes these effects
/// to mutate editor state.
///
/// # Example
///
/// ```ignore
/// use xeno_registry::{ActionEffects, ActionResult, AppEffect, Mode};
///
/// // Motion action
/// ActionResult::Effects(ActionEffects::motion(selection))
///
/// // Composed action: motion + mode change
/// ActionResult::Effects(
///     ActionEffects::motion(sel).with(AppEffect::SetMode(Mode::Insert))
/// )
///
/// // No-op
/// ActionResult::Effects(ActionEffects::ok())
/// ```
#[derive(Debug, Clone, DispatchResult)]
pub enum ActionResult {
	/// Apply a set of composable effects.
	///
	/// This is the sole variant - all editor state changes are expressed
	/// as compositions of primitive [`Effect`](crate::Effect) values.
	Effects(ActionEffects),
}
