#![allow(
	unused_crate_dependencies,
	reason = "binary lives in xeno-registry package and relies on shared deps"
)]

use xeno_registry::{RegistryMetadata, all_actions};

fn print_registry<T: RegistryMetadata + 'static>(
	label: &str,
	items: impl IntoIterator<Item = &'static T>,
) {
	let mut ids: Vec<&'static str> = items.into_iter().map(|item| item.id()).collect();
	ids.sort_unstable();

	println!("## {} ({})", label, ids.len());
	for id in ids {
		println!("- {}", id);
	}
	println!();
}

fn print_notifications(
	label: &str,
	items: impl IntoIterator<Item = &'static xeno_registry::NotificationDef>,
) {
	let mut ids: Vec<&'static str> = items.into_iter().map(|item| item.id).collect();
	ids.sort_unstable();

	println!("## {} ({})", label, ids.len());
	for id in ids {
		println!("- {}", id);
	}
	println!();
}

fn main() {
	println!("# Registry Inventory");
	println!();
	println!("Generated by `cargo run -p xeno-registry --bin registry_inventory`.");
	println!();

	print_registry("Actions", all_actions());
	print_registry("Commands", xeno_registry::commands::COMMANDS.iter());
	print_registry("Motions", xeno_registry::motions::MOTIONS.iter());
	print_registry("Gutters", xeno_registry::gutter::GUTTERS.iter());
	print_registry("Hooks", xeno_registry::hooks::HOOKS.iter());
	print_registry(
		"Statusline Segments",
		xeno_registry::statusline::STATUSLINE_SEGMENTS.iter(),
	);
	print_registry("Text Objects", xeno_registry::textobj::TEXT_OBJECTS.iter());
	print_registry("Options", xeno_registry::options::OPTIONS.iter());
	print_registry("Themes", xeno_registry::themes::THEMES.iter());
	print_notifications(
		"Notifications",
		xeno_registry::notifications::NOTIFICATIONS.iter().copied(),
	);
}
